import numpy as np
from keras.models import load_model
from keras.preprocessing.sequence import pad_sequences 

max_review_length = 20 #maximum length of the sentence

pmodel = load_model('231019_1600_model.h5')

tokenizer = {'吗': 1, '的': 2, '我': 3, '了': 4, '交': 5, '保': 6, '社': 7, '么': 8, '月': 9, '以': 10, '是': 11, '可': 12, '缴': 13, '要': 14, '好': 15, '不': 16, '个': 17, '一': 18, '公': 19, '有': 20, '这': 21, '下': 22, '金': 23, '你': 24, '上': 25, '在': 26, '能': 27, '怎': 28, '什': 29, '积': 30, '多': 31, '吧': 32, '补': 33, '，': 34, '那': 35, '谢': 36, '问': 37, '费': 38, '呢': 39, '少': 40, '拍': 41, '没': 42, '需': 43, '付': 44, '？': 45, '海': 46, '代': 47, '就': 48, '州': 49, '想': 50, '份': 51, '钱': 52, '办': 53, '5': 54, '还': 55, '纳': 56, '户': 57, '到': 58, '们': 59, '已': 60, '现': 61, '看': 62, '哦': 63, '款': 64, '提': 65, '啊': 66, '用': 67, '只': 68, '时': 69, '查': 70, '都': 71, '行': 72, '司': 73, '前': 74, '经': 75, '险': 76, '单': 77, '之': 78, '给': 79, '五': 80, '职': 81, '请': 82, '人': 83, '对': 84, '理': 85, '嗯': 86, '询': 87, '几': 88, '啥': 89, '最': 90, '断': 91, '去': 92, '信': 93, '填': 94, '直': 95, '接': 96, '4': 97, '帮': 98, '来': 99, '成': 100, '后': 101, '区': 102, '料': 103, '续': 104, '过': 105, '麻': 106, '烦': 107, '表情': 108, '会': 109, '贷': 110, '号': 111, '哪': 112, '基': 113, '杭': 114, '生': 115, '样': 116, '收': 117, '开': 118, '边': 119, '影': 120, '响': 121, '资': 122, '转': 123, '落': 124, '明': 125, '里': 126, '买': 127, '也': 128, '天': 129, '话': 130, '证': 131, '房': 132, '工': 133, '说': 134, '程': 135, '您': 136, '退': 137, '数': 138, '候': 139, '为': 140, '三': 141, '息': 142, '哈': 143, '如': 144, '卡': 145, '出': 146, '做': 147, '亲': 148, '先': 149, '作': 150, '知': 151, '完': 152, '年': 153, '务': 154, '事': 155, '和': 156, '离': 157, '税': 158, '地': 159, '小': 160, '道': 161, '停': 162, '入': 163, '间': 164, '低': 165, '北': 166, '京': 167, '意': 168, '服': 169, '中': 170, '新': 171, '广': 172, '供': 173, '合': 174, '家': 175, '分': 176, '找': 177, '日': 178, '本': 179, '育': 180, '别': 181, '思': 182, '发': 183, '算': 184, '快': 185, '啦': 186, '再': 187, '期': 188, '同': 189, '咨': 190, '苏': 191, '果': 192, '码': 193, '写': 194, '始': 195, '回': 196, '2': 197, '手': 198, '调': 199, '才': 200, '嘛': 201, '忙': 202, '得': 203, '及': 204, '准': 205, '备': 206, '加': 207, '解': 208, '流': 209, '链': 210, '额': 211, '电': 212, '材': 213, '题': 214, '住': 215, '学': 216, '长': 217, '选': 218, '四': 219, '验': 220, '3': 221, '业': 222, '每': 223, '晚': 224, '6': 225, '今': 226, '功': 227, '应': 228, '参': 229, '按': 230, '必': 231, '受': 232, '重': 233, '部': 234, '方': 235, '度': 236, '名': 237, '很': 238, '两': 239, '老': 240, '沙': 241, '所': 242, '外': 243, '1': 244, '11': 245, '0': 246, '10': 247, '些': 248, '比': 249, '呀': 250, '但': 251, '确': 252, '定': 253, '进': 254, '7': 255, '刚': 256, '截': 257, 'ok': 258, '联': 259, '系': 260, '嗷': 261, '正': 262, '忘': 263, '记': 264, '弄': 265, '次': 266, '价': 267, '取': 268, '封': 269, '存': 270, '操': 271, '改': 272, '高': 273, '南': 274, '他': 275, '然': 276, '全': 277, '居': 278, '面': 279, '留': 280, '微': 281, '医': 282, '账': 283, '城': 284, '位': 285, '种': 286, '序': 287, '细': 288, '暂': 289, '包': 290, '括': 291, '通': 292, '底': 293, '法': 294, '马': 295, '贴': 296, '该': 297, '9': 298, '止': 299, '懂': 300, '报': 301, '购': 302, '须': 303, '哔': 304, '常': 305, '跟': 306, '客': 307, '首': 308, '太': 309, '淘': 310, '宝': 311, '王': 312, '连': 313, '支': 314, '恩': 315, '介': 316, '朋': 317, '友': 318, '减': 319, '点': 320, '字': 321, '籍': 322, '口': 323, '换': 324, '票': 325, '起': 326, '白': 327, '久': 328, '领': 329, '子': 330, '试': 331, '市': 332, '因': 333, '银': 334, '孩': 335, '情': 336, '况': 337, '共': 338, '园': 339, '真': 340, '综': 341, '3290': 342, '17': 343, '80': 344, '30': 345, '120656': 346, '机': 347, '例': 348, '3500': 349, '觉': 350, '40': 351, '限': 352, '辞': 353, '档': 354, '26': 355, '签': 356, '具': 357, '气': 358, '漏': 359, '差': 360, '贞': 361, '大': 362, '概': 363, '便': 364, '更': 365, '读': 366, '书': 367, '送': 368, '注': 369, '绍': 370, '员': 371, '光': 372, '其': 373, '尽': 374, '认': 375, '突': 376, '汇': 377, '录': 378, '咋': 379, '叫': 380, '养': 381, '山': 382, '湖': 383, '俩': 384, '聊': 385, '六': 386, '劳': 387, '动': 388, '目': 389, '移': 390, '否': 391, '择': 392, '姐': 393, '无': 394, '津': 395, '规': 396, '自': 397, '己': 398, '怕': 399, '午': 400, '“': 401, '”': 402, '何': 403, '涨': 404, '怀': 405, '孕': 406, '搞': 407, '考': 408, '虑': 409, '她': 410, '整': 411, '维': 412, '旺': 413, '届': 414, '毕': 415, '状': 416, '态': 417, '销': 418, '享': 419, '册': 420, '院': 421, '江': 422, '当': 423, '相': 424, '文': 425, '般': 426, '照': 427, '总': 428, '160': 429, '923': 430, '1867': 431, '12333': 432, '20201': 433, '20358': 434, '21377': 435, '17358239536': 436, '72e': 437, '92e': 438, '62e': 439, '11e': 440, '活': 441, '60': 442, '图片': 443, '内': 444, '1000': 445, '50': 446, '万': 447, '103': 448, '120': 449, '元': 450, '12027': 451, '486': 452, '20': 453, '53861': 454, '15': 455, '163': 456, '1856': 457, '18621321922': 458, '19377': 459, '2000': 460, '貌': 461, '似': 462, '39735': 463, '240': 464, '预': 465, '邮': 466, '箱': 467, '54': 468, '岁': 469, '58': 470, '2018': 471, '深': 472, '申': 473, '70': 474, '乘': 475, '12': 476, '840': 477, '130601': 478, 'hello': 479, 'hi': 480, 'nono': 481, 'tks': 482, 'yourenma': 483, 'zai': 484, 'ma': 485, '科': 486, '纰': 487, '承': 488, '诺': 489, '初': 490, '独': 491, '咯': 492, '稍': 493, '等': 494, '肯': 495, '蛮': 496, '贵': 497, '屋': 498, '放': 499, '心': 500, '走': 501, '告': 502, '诉': 503, '尴': 504, '尬': 505, '感': 506, '搭': 507, '嘎': 508, '。': 509, '队': 510, '够': 511, '裸': 512, '量': 513, '哒': 514, '滴': 515, '愉': 516, '厉': 517, '害': 518, '休': 519, '花': 520, '呗': 521, '黄': 522, '孟': 523, '琪': 524, '继': 525, '或': 526, '者': 527, '齐': 528, '称': 529, '复': 530, '柜': 531, '台': 532, '言': 533, '充': 534, '昆': 535, '板': 536, '省': 537, '李': 538, '亚': 539, '霏': 540, '旬': 541, '美': 542, '女': 543, '残': 544, '章': 545, '纯': 546, '八': 547, '固': 548, '从': 549, '义': 550, '赠': 551, '锡': 552, '诚': 553, '属': 554, '于': 555, '力': 556, '源': 557, '渠': 558, 'h': 559, 'r': 560, '处': 561, '式': 562, '车': 563, '牌': 564, '企': 565, '死': 566, '国': 567, '缺': 568, '班': 569, '编': 570, '变': 571, '块': 572, '郁': 573, '闷': 574, '稽': 575, '严': 576, '十': 577, '搜': 578, '址': 579, '打': 580, '扰': 581, '仓': 582, '显': 583, '示': 584, '求': 585, '挺': 586, '让': 587, '网': 588, '往': 589, '护': 590, '洛': 591, '把': 592, '推': 593, '荐': 594, 'i': 595, 'd': 596, '订': 597, '图': 598, '刷': 599, '妈': 600, '原': 601, '失': 602, '语': 603, '吴': 604, '喜': 605, '爱': 606, '满': 607, '产': 608, '欠': 609, '术': 610, '教': 611, '德': 612, '镇': 613, '辛': 614, '苦': 615, '表': 616, '姓': 617, '东': 618, '西': 619, '历': 620, '化': 621, '校': 622, '吓': 623, '周': 624, '未': 625, '使': 626, '掉': 627, '片': 628, '优': 629, '惠': 630, '体': 631, '闲': 632, '林': 633, '又': 634, '嵊': 635, '登': 636, '陆': 637, '呐': 638, '拿': 639, '二': 640, '套': 641, '由': 642, '冲': 643, '实': 644, '效': 645, '笑': 646, '锦': 647, '第': 648, '空': 649, '朱': 650, '嘉': 651, '佑': 652, '河': 653, '郑': 654, '计': 655, '假': 656}

reverse_word_map = {1: 0, 2: 'complicated', 3: 'no_intent', 4: 'purchase', 5: 'affirm', 6: 'unknown', 7: 'chitchat', 8: 'inform_paid', 9: 'query_pay_process', 10: 'ask_can_topup', 11: 'doublecheck', 12: 'ask_shebao_status', 13: 'purchase_wxyj', 14: 'greet', 15: 'thankyou', 16: 'ask_amt_month_fee_total', 17: 'query_req_resources', 18: 'check_can_pay_current_month', 19: 'confused', 20: 'inform_payment_history', 21: 'deny', 22: 'check_is_possible', 23: 'ask_verify', 24: 'get_back_later', 25: 'query_pay_deadline', 26: 'gongjijin_only', 27: 'query_when_check_shebao_status', 28: 'complain', 29: 'request_link', 30: 'query_how_check_shebao_status', 31: 'how_to_pai', 32: 'ask_for_phone', 33: 'affirm#thankyou', 34: 'inform_info_filled', 35: 'apology', 36: 'query_pay_part_only', 37: 'clarify', 38: 'report_issue', 39: 'ask_amt_service_fee', 40: 'query_product_explain', 41: 'question_why', 42: 'query_refund', 43: 'ask_for_refund', 44: 'reassure', 45: 'ask_discount', 46: 'query_weixin', 47: 'ask_turnaround_time', 48: 'missing_info', 49: 'req_check', 50: 'query_have_service_fee', 51: 'purchase_gjj', 52: 'check_anything_else', 53: 'ask_kai_piao', 54: 'query_payment_schedule', 55: 'query_canzhangjin', 56: 'pay_query', 57: 'affirm#chitchat', 58: 'next_step', 59: 'check_procedure_card', 60: 'query_wxyj_included', 61: 'request_future_notify', 62: 'query_pregnant', 63: 'check_procedure_shouce', 64: 'total_amt_query', 65: 'ask_for_details', 66: 'ask_how_now', 67: 'question_reliability'}

def pred_to_word(pred):
    best = np.max(pred)
    total = np.sum(pred)        
    print(pred,"best",best)
    oout = np.where(pred == best)
    print(oout)
    idx = oout[1][0]
    intent = reverse_word_map[idx]
    print("Intent:{} Confidence:{}%".format(intent,best*100/total))

while 1:
    print("Please enter an input:")
    raw_inp = input()
    inp = []
    for char in raw_inp:
        if char in tokenizer:
            conv = tokenizer[char]
        else:
            conv = 0
        inp.append(conv)
    inp = pad_sequences([inp,], max_review_length)
    # print("pro in",inp)
    out = pmodel.predict([inp])
    pred_to_word(out)